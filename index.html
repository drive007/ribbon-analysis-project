--- START OF FILE index.html ---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard: Ribbon Consolidation Analysis & Action Plan (Interactive)</title>
    <style>
        /* --- CSS Variables and Base Styles (Mostly Same) --- */
        :root {
            --bg-color: #f4f7f9;
            --card-bg: #ffffff;
            --text-color: #333;
            --heading-color: #0056b3;
            --border-color: #d6dde3;
            --shadow-color: rgba(0, 0, 0, 0.07);
            --accent-green: #28a745;
            --accent-red: #dc3545;
            --accent-orange: #fd7e14;
            --accent-blue: #007bff;
            --font-primary: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --best-option-highlight-bg: #eaf7ec;
            --best-option-border-color: #95d7a1;
            --worst-option-highlight-bg: #fff0f1;
            --worst-option-border-color: #f1b0b7;
            --bar-color-8394: #007bff;
            --bar-color-8393: #001f5a;
            --bar-color-8392: #e67e22;
            --table-header-bg: #e9ecef;
            --status-completed-bg: #d4edda; /* Light Green for Completed */
            --status-in-progress-bg: #fff3cd; /* Light Yellow for In Progress */
        }
        body { font-family: var(--font-primary); background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 15px; line-height: 1.5; }
        .dashboard-container { max-width: 1300px; margin: auto; background-color: var(--card-bg); padding: 25px; border-radius: 10px; box-shadow: 0 3px 10px var(--shadow-color); border: 1px solid var(--border-color); }
        header { text-align: center; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 25px; }
        header h1 { color: var(--heading-color); margin: 0 0 5px 0; font-size: 1.8em; font-weight: 600; }
        header p { margin: 5px 0; color: #555; font-size: 1.1em; }
        header .current-cost { font-weight: bold; color: var(--accent-red); }
        .section { margin-bottom: 30px; }
        .section h2 { color: var(--heading-color); font-size: 1.4em; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color); text-align: center; }

        /* --- Current Situation & Options Grid (Same Styles) --- */
        .chart-container { border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .chart-container h3 { text-align: center; margin-top: 0; margin-bottom: 15px; font-size: 1.1em; color: #444; }
        .bar-chart-visual { display: flex; flex-direction: column; gap: 8px; }
        .bar-item { display: flex; align-items: center; gap: 10px; }
        .bar-label { width: 60px; font-size: 0.9em; color: #555; text-align: right; flex-shrink: 0; }
        .bar-wrapper { flex-grow: 1; background-color: #f0f0f0; border-radius: 4px; overflow: hidden; }
        .bar { height: 20px; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 5px; color: white; font-size: 0.8em; white-space: nowrap; }
        .bar.item-8394 { background-color: var(--bar-color-8394); }
        .bar.item-8393 { background-color: var(--bar-color-8393); }
        .bar.item-8392 { background-color: var(--bar-color-8392); }
        .current-summary-table { width: 100%; border-collapse: collapse; font-size: 0.9em; margin-top: 15px;}
        .current-summary-table th, .current-summary-table td { border: 1px solid var(--border-color); padding: 8px; text-align: right; }
        .current-summary-table th { background-color: var(--table-header-bg); text-align: left;}
        .current-summary-table tfoot td { font-weight: bold; }
        .current-summary-table .item-no { text-align: left; }
        .problems-list { list-style: none; padding: 0; }
        .problems-list li { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 10px 15px; margin-bottom: 10px; border-radius: 4px; }
        .problems-list strong { color: #856404; }
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(230px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .option-card { border: 1px solid var(--border-color); border-radius: 8px; padding: 18px; background-color: #fdfdfd; display: flex; flex-direction: column; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .option-card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }
        .option-card.best-option { background-color: var(--best-option-highlight-bg); border: 2px solid var(--best-option-border-color); box-shadow: 0 4px 12px rgba(40, 167, 69, 0.15); }
        .option-card.best-option h2 { color: var(--accent-green); }
        .option-card.worst-consolidation-option { background-color: var(--worst-option-highlight-bg); border: 2px solid var(--worst-option-border-color); box-shadow: 0 4px 12px rgba(220, 53, 69, 0.1); }
        .option-card.worst-consolidation-option h2 { color: var(--accent-red); }
        .option-card h2 { margin-top: 0; margin-bottom: 15px; font-size: 1.2em; color: var(--heading-color); text-align: center; border-bottom: 1px solid #eee; padding-bottom: 8px; font-weight: 600; }
        .option-card h2 .brand { font-weight: 400; font-size: 0.9em; color: #666; display: block; }
        .metric { margin-bottom: 10px; font-size: 0.9em; line-height: 1.4; }
        .metric strong { display: block; color: #555; margin-bottom: 2px; font-weight: 600; font-size: 0.85em; text-transform: uppercase; }
        .metric .value { font-size: 1.05em; font-weight: bold; padding: 1px 0; }
        .metric .value.cost { color: var(--heading-color); }
        .metric .value.risk-critical { color: var(--accent-red); }
        .metric .value.risk-medium { color: var(--accent-orange); }
        .metric .value.risk-low { color: var(--accent-green); }
        .metric .note { font-size: 0.85em; color: #666; display: block; margin-top: 2px;}
        .savings-metric { margin-top: auto; padding-top: 10px; border-top: 1px dashed var(--border-color); text-align: center; }
        .savings-metric strong { font-size: 0.9em; text-transform: uppercase; color: #555; margin-bottom: 4px; }
        .savings-metric .value { font-size: 1.5em; font-weight: bold; color: var(--accent-green); }
        .savings-metric .note { font-size: 0.85em; color: #666;}
        .savings-metric .per-roll { font-size: 0.95em; color: var(--accent-green); font-weight: 500; display: block; margin-top: 5px;}
        .durability-icon { font-size: 1.3em; margin-right: 5px; }
        .durability-basic { color: #6c757d; }
        .durability-good { color: #17a2b8; }
        .durability-verygood { color: #0056b3; }
        .durability-excellent { color: #004085; }
        .details-button { display: block; padding: 9px 15px; margin-top: 10px; background-color: var(--heading-color); color: white !important; text-decoration: none; border: none; border-radius: 5px; text-align: center; font-size: 0.9em; font-weight: 500; cursor: pointer; transition: background-color 0.3s ease, box-shadow 0.2s ease; }
        .details-button:hover { background-color: #004085; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
        .option-card.best-option .details-button { background-color: var(--accent-green); }
        .option-card.best-option .details-button:hover { background-color: #1e7e34; }
        .option-card.worst-consolidation-option .details-button { background-color: var(--accent-red); }
        .option-card.worst-consolidation-option .details-button:hover { background-color: #a71d2a; }

        /* --- Action Plan / To-Do List --- */
        .action-plan-box { margin-top: 25px; padding: 25px; border: 1px solid var(--border-color); border-radius: 8px; background-color: #f0f8ff; border-left: 5px solid var(--accent-orange); }
        .action-plan-box h2 { color: var(--heading-color); text-align: center; }
        .action-buttons { text-align: right; margin-bottom: 15px; margin-top: -10px; display: flex; justify-content: space-between; align-items: center;}
        .action-buttons button, .action-buttons a { padding: 6px 12px; margin-left: 8px; font-size: 0.85em; border-radius: 4px; cursor: pointer; text-decoration: none; color: white; border: none; }
        .add-row-btn { background-color: var(--accent-blue); }
        .add-row-btn:hover { background-color: #0056b3; }
        .save-btn { background-color: var(--accent-green); }
        .save-btn:hover { background-color: #1e7e34; }
        .confirm-btn { background-color: var(--accent-orange); }
        .confirm-btn:hover { background-color: #d35400; }
        .cancel-confirm-btn { background-color: #6c757d; /* Grey */ }
        .cancel-confirm-btn:hover { background-color: #5a6268; }
        .cancel-confirm-btn:disabled, .cancel-confirm-btn[disabled] {
            background-color: #adb5bd !important;
            opacity: 0.5 !important;
            cursor: not-allowed !important;
        }
        .export-btn { background-color: #1a5276 ; }
        .export-btn:hover { background-color: #113a56; }
        .hidden-file-input { display: none; }
        .import-btn { background-color: var(--accent-purple); } /* Assuming --accent-purple is defined if used */
        .import-btn:hover { background-color: #5a2b9d; }      /* Assuming --accent-purple is defined if used */


        .todo-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9em; }
        .todo-table th, .todo-table td { border: 1px solid #ccc; padding: 8px 10px; text-align: left; vertical-align: top; }
        .todo-table th { background-color: #d6eaf8; font-weight: 600; vertical-align: middle;}
        .todo-table select, .todo-table input, .todo-table textarea {
             width: 98%;
             padding: 5px;
             border: 1px solid #ccc;
             border-radius: 4px;
             font-size: 1em;
             box-sizing: border-box;
             margin-bottom: 4px;
         }
         /* Status specific colors */
        .status-select.status-completed { background-color: var(--status-completed-bg); color: #155724;}
        .status-select.status-in-progress { background-color: var(--status-in-progress-bg); color: #856404;}

         .task-cell-content { display: flex; flex-direction: column; }
         .task-input { margin-bottom: 8px !important; }
         .sub-details {
             display: flex;
             gap: 15px;
             margin-top: 5px;
             padding-left: 15px;
             border-left: 2px solid #eee;
             padding-top: 8px;
             padding-bottom: 8px;
         }
         .responsible-block, .notes-block {
             flex: 1;
             min-width: 150px;
         }
         .responsible-block label, .notes-block label {
             display: block;
             font-size: 0.8em;
             color: #666;
             margin-bottom: 3px;
             font-weight: 500;
             text-transform: uppercase;
         }
         .responsible-block select, .responsible-block input,
         .notes-block textarea {
            width: 100%;
            font-size: 0.95em !important;
         }
         .notes-block textarea { height: auto; min-height: 45px; }


         .todo-table td:nth-child(1) { width: 45%; }
         .todo-table td:nth-child(2) { width: 15%; }
         .todo-table td:nth-child(3) { width: 100px; }
         .todo-table td:last-child { width: 70px; text-align: center; vertical-align: middle;}

         .action-btn { background: none; border: none; cursor: pointer; font-size: 1.1em; padding: 2px 4px; vertical-align: middle; }
         .move-up-btn { color: var(--accent-blue); }
         .move-down-btn { color: var(--accent-blue); }
         .delete-row-btn { color: var(--accent-red); }
         .confirmed input, .confirmed select, .confirmed textarea, .confirmed .details-button { background-color: #e9ecef !important; cursor: not-allowed !important; opacity: 0.7 !important; pointer-events: none; }
         .confirmed .action-btn { display: none; }
         .confirmed .details-button { color: #6c757d !important; border: 1px solid #ced4da !important;}
         .confirmed .status-select { /* Ensure confirmed status boxes are greyed out */
            background-color: #e9ecef !important;
            color: #495057 !important; /* Default text color for disabled inputs */
            opacity: 0.7 !important;
         }


        /* --- Notes Footer --- */
        .notes { text-align: center; font-size: 0.85em; color: #777; margin-top: 30px; padding-top: 15px; border-top: 1px dashed var(--border-color); }

        /* --- Responsive --- */
        @media (max-width: 992px) {
            .options-grid { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
            .sub-details { flex-direction: column; gap: 8px; }
        }
        @media (max-width: 768px) {
            .options-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
            header h1 { font-size: 1.6em; }
            .option-card h2 { font-size: 1.15em; }
            .todo-table { display: block; overflow-x: auto; }
            .todo-table th, .todo-table td { white-space: normal; }
             .todo-table td:nth-child(1) { min-width: 250px; }
             .todo-table td:nth-child(2) { min-width: 120px; }
             .todo-table td:nth-child(3) { min-width: 100px; }
             .todo-table td:last-child { min-width: 70px; }
        }
        @media (max-width: 576px) {
            .options-grid { grid-template-columns: 1fr; }
            header p { font-size: 1em; }
            .action-plan-box h2 { font-size: 1.3em; }
        }

    </style>
</head>
<body>
    <div class="dashboard-container">
         <header>
             <h1>Ribbon Consolidation Analysis & Action Plan</h1>
             <p>Evaluating Single & Multi-Ribbon Replacements for 3 Current SKUs</p>
        </header>

        <!-- Current Situation Section -->
        <div class="section">
            <h2>Current Situation (2024 Data)</h2>
             <div class="chart-container">
                 <h3>Total Annual Purchase Quantity</h3>
                 <div class="bar-chart-visual">
                     <div class="bar-item"> <span class="bar-label">8-394 (W/R)</span><div class="bar-wrapper"><div class="bar item-8394" style="width: 100%;">800</div></div> </div>
                     <div class="bar-item"> <span class="bar-label">8-393 (Wax)</span><div class="bar-wrapper"><div class="bar item-8393" style="width: 68.75%;">550</div></div> </div>
                     <div class="bar-item"> <span class="bar-label">8-392 (W/R)</span><div class="bar-wrapper"><div class="bar item-8392" style="width: 26.25%;">210</div></div> </div>
                 </div>
                 <table class="current-summary-table">
                    <thead><tr><th class="item-no">Item No.</th><th>Type</th><th>Rolls/Year</th><th>Avg Rolls/Month</th><th>Cost/Roll (THB)</th><th>Est. Annual Cost (THB)</th></tr></thead>
                    <tbody>
                        <tr><td class="item-no">8-394</td><td>Wax/Resin</td><td>800</td><td>~67</td><td>675</td><td>~540,000</td></tr>
                        <tr><td class="item-no">8-393</td><td>Wax</td><td>550</td><td>~46</td><td>305</td><td>~167,750</td></tr>
                        <tr><td class="item-no">8-392</td><td>Wax/Resin</td><td>210</td><td>~18</td><td>575</td><td>~120,750</td></tr>
                    </tbody>
                    <tfoot><tr><td colspan="2" class="item-no"><strong>Total / Weighted Avg</strong></td><td><strong>1,560</strong></td><td><strong>130</strong></td><td><strong>~531</strong></td><td><strong>~828,500</strong></td></tr></tfoot>
                </table>
             </div>
             <div class="chart-container">
                 <h3>Identified Problems</h3>
                 <ul class="problems-list">
                     <li><strong>High Cost:</strong> Current weighted average cost/roll is ~531 THB. Total annual spend: <strong class="current-cost">~828,500 THB</strong>.</li>
                    <li><strong>Potential Ribbon Waste:</strong> Using 117mm ribbon (8-394) for labels narrower than 110mm leads to unused material.</li>
                    <li><strong>Complexity:</strong> Managing 3 SKUs increases overhead & potential user error. (Reduced to 2 SKUs with scenario)</li>
                 </ul>
            </div>
        </div>

        <!-- Consolidation Options Section -->
         <div class="section">
             <h2>Consolidation Options Analysis</h2>
             <div class="options-grid">
                 <!-- Scenario: K2000 + K102N - New Best Option -->
                 <div class="option-card best-option">
                     <h2>K2000 + K102N <span class="brand">KURZ Scenario (2 SKUs)</span></h2>
                     <div class="metric"><strong>Type:</strong> <span class="value">Wax/Resin + Wax</span></div>
                     <div class="metric"><strong>Durability:</strong> <span class="value"><span class="durability-icon durability-good">■</span>Maintained</span> <span class="note">Appropriate types used</span></div>
                     <div class="metric"><strong>Price/Roll:</strong> <span class="value cost">K2000@245, K102N@175</span> <span class="note">(THB, specific sizes)</span></div>
                     <div class="metric"><strong>Durability Risk:</strong> <span class="value risk-low">Low</span> <span class="note">Reduces SKU complexity (3 to 2)</span></div>
                     <div class="savings-metric">
                         <strong>Est. Annual Savings</strong>
                         <span class="value">~485k THB</span><span class="note">(~58.5%)</span>
                         <span class="per-roll">~311 THB Saved/Roll (Avg)</span>
                     </div>
                     <a href="Analysis_K2000_K102N_Scenario.html" target="_blank" class="details-button">View Scenario Details</a>
                 </div>

                 <!-- KURZ K2000 - Best Option (Single SKU Replacement) -->
                  <div class="option-card best-option">
                     <h2>K2000 <span class="brand">KURZ (Single SKU)</span></h2>
                     <div class="metric"><strong>Type:</strong> <span class="value">Wax/Resin (Std)</span></div>
                     <div class="metric"><strong>Durability:</strong> <span class="value"><span class="durability-icon durability-good">■</span>Good</span></div>
                     <div class="metric"><strong>Price/Roll:</strong> <span class="value cost">245 THB</span> <span class="note">(117mm used)</span></div>
                     <div class="metric"><strong>Durability Risk:</strong> <span class="value risk-low">Low</span> <span class="note">Similar type to current W/R</span></div>
                      <div class="savings-metric">
                         <strong>Est. Annual Savings</strong>
                         <span class="value">~446k THB</span><span class="note">(~53.9%)</span>
                         <span class="per-roll">~286 THB Saved/Roll (Avg)</span>
                     </div>
                     <a href="Analysis_K2000.html" target="_blank" class="details-button">View Details</a>
                 </div>
                  <!-- SATO T102F -->
                 <div class="option-card">
                     <h2>T102F <span class="brand">SATO</span></h2>
                     <div class="metric"><strong>Type:</strong> <span class="value">Wax</span></div>
                     <div class="metric"><strong>Durability:</strong> <span class="value"><span class="durability-icon durability-basic">■</span>Basic</span></div>
                     <div class="metric"><strong>Price/Roll:</strong> <span class="value cost">295 THB</span> <span class="note">(110mm)</span></div>
                     <div class="metric"><strong>Durability Risk:</strong> <span class="value risk-critical">Critical</span> <span class="note">vs. current W/R</span></div>
                     <div class="savings-metric">
                         <strong>Est. Annual Savings</strong>
                         <span class="value">~368k THB</span><span class="note">(~44.5%)</span>
                         <span class="per-roll">~236 THB Saved/Roll (Avg)</span>
                     </div>
                     <a href="Analysis_T102F.html" target="_blank" class="details-button">View Details</a>
                 </div>
                 <!-- KURZ K102N -->
                 <div class="option-card">
                     <h2>K102N <span class="brand">KURZ</span></h2>
                     <div class="metric"><strong>Type:</strong> <span class="value">Wax (Standard)</span></div>
                     <div class="metric"><strong>Durability:</strong> <span class="value"><span class="durability-icon durability-basic">■</span>Basic</span></div>
                     <div class="metric"><strong>Price/Roll:</strong> <span class="value cost">155 THB</span> <span class="note">(117mm used)</span></div>
                     <div class="metric"><strong>Durability Risk:</strong> <span class="value risk-critical">Critical</span> <span class="note">vs. current W/R</span></div>
                      <div class="savings-metric">
                         <strong>Est. Annual Savings</strong>
                         <span class="value">~587k THB</span><span class="note">(~70.8%)</span>
                         <span class="per-roll">~376 THB Saved/Roll (Avg)</span>
                     </div>
                     <a href="Analysis_K102N.html" target="_blank" class="details-button">View Details</a>
                 </div>
                  <!-- KURZ K103N -->
                  <div class="option-card">
                     <h2>K103N <span class="brand">KURZ</span></h2>
                     <div class="metric"><strong>Type:</strong> <span class="value">Wax (Premium)</span></div>
                     <div class="metric"><strong>Durability:</strong> <span class="value"><span class="durability-icon durability-basic">■</span>Basic+</span> <span class="note">Slightly better Wax</span></div>
                     <div class="metric"><strong>Price/Roll:</strong> <span class="value cost">190 THB</span> <span class="note">(117mm used)</span></div>
                     <div class="metric"><strong>Durability Risk:</strong> <span class="value risk-critical">Critical</span> <span class="note">vs. current W/R</span></div>
                      <div class="savings-metric">
                         <strong>Est. Annual Savings</strong>
                         <span class="value">~532k THB</span><span class="note">(~64.2%)</span>
                         <span class="per-roll">~341 THB Saved/Roll (Avg)</span>
                     </div>
                     <a href="Analysis_K103N.html" target="_blank" class="details-button">View Details</a>
                 </div>
                  <!-- KURZ K308 -->
                  <div class="option-card">
                     <h2>K308 <span class="brand">KURZ</span></h2>
                     <div class="metric"><strong>Type:</strong> <span class="value">Wax/Resin (Prem)</span></div>
                     <div class="metric"><strong>Durability:</strong> <span class="value"><span class="durability-icon durability-verygood">■</span>Very Good</span></div>
                     <div class="metric"><strong>Price/Roll:</strong> <span class="value cost">315 THB</span> <span class="note">(117mm used)</span></div>
                     <div class="metric"><strong>Durability Risk:</strong> <span class="value risk-low">Low</span> <span class="note">Likely exceeds current W/R</span></div>
                      <div class="savings-metric">
                         <strong>Est. Annual Savings</strong>
                         <span class="value">~337k THB</span><span class="note">(~40.7%)</span>
                         <span class="per-roll">~216 THB Saved/Roll (Avg)</span>
                     </div>
                     <a href="Analysis_K308.html" target="_blank" class="details-button">View Details</a>
                 </div>
                 <!-- KURZ K504 - Worst Option -->
                  <div class="option-card worst-consolidation-option">
                     <h2>K504 <span class="brand">KURZ</span></h2>
                     <div class="metric"><strong>Type:</strong> <span class="value">Resin (Premium)</span></div>
                     <div class="metric"><strong>Durability:</strong> <span class="value"><span class="durability-icon durability-excellent">■</span>Excellent</span></div>
                     <div class="metric"><strong>Price/Roll:</strong> <span class="value cost">~480 THB</span> <span class="note">(Example Size)</span></div>
                     <div class="metric"><strong>Use Case:</strong> <span class="value" style="color: var(--heading-color)">Specialized</span><span class="note">Only for extreme durability needs.</span></div>
                      <div class="savings-metric">
                          <strong>Est. Annual Savings</strong>
                         <span class="value" style="color:var(--accent-red)">N/A*</span><span class="note">Likely higher cost</span>
                         <span class="per-roll" style="color:var(--accent-red)">~ -51 THB Saved/Roll (Avg)</span>
                     </div>
                      <a href="Analysis_K504.html" target="_blank" class="details-button">View Details</a>
                 </div>
             </div>
        </div> <!-- End Options Section -->

        <!-- Action Plan Section (Updated Structure) -->
        <div class="section action-plan-box">
            <h2>Action Plan & To-Do List</h2>
             <div class="action-buttons">
                 <button class="add-row-btn" onclick="addTaskRow()">+ Add Task</button>
                 <div>
                    <button class="save-btn" onclick="saveData()">Save Changes</button>
                    <button class="confirm-btn" onclick="confirmData()">Confirm Plan</button>
                    <button class="cancel-confirm-btn" onclick="cancelConfirmData()">Cancel Confirmation</button>
                    <a href="#" class="export-btn" onclick="exportToExcel(event)">Export to Excel</a>
                 </div>
             </div>
            <table class="todo-table" id="todoTable">
                <thead>
                    <tr>
                        <th>Task Description & Details</th> <!-- Combined Column -->
                        <th>Status</th>
                        <th>Target Due</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="todoTableBody">
                    <!-- Rows will be populated by JavaScript -->
                </tbody>
            </table>
        </div> <!-- End Action Plan Section -->

        <!-- Notes Footer -->
        <div class="notes">
             Analysis based on 2024 usage data and provided quotations/datasheets (Apr 2025 Prices). Savings calculated assuming full 1,560 roll replacement for single SKU options. Scenario savings calculated based on its specific roll distribution.
            <br><strong>*K504 Savings N/A:</strong> Full replacement would likely increase total costs. Button links placeholders.
            <br><strong>Thorough testing confirming print quality, durability, and operational impact is essential before any change.</strong>
        </div>

    </div> <!-- End Dashboard Container -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        const LOCAL_STORAGE_KEY = 'ribbonConsolidationPlanV10'; // Updated key for status colors
        const todoTableBody = document.getElementById('todoTableBody');
        const departments = ["Procurement", "QA", "Production", "Engineering", "IT", "Maintenance", "Management", "Finance", "Other"];
        const statusOptions = {
            "not-started": "Not Started", "in-progress": "In Progress", "completed": "Completed",
            "blocked": "Blocked", "on-hold": "On Hold", "scheduled": "Scheduled",
            "planning": "Planning", "na": "N/A"
        };

        let currentTasks = [
            {
                task: "1. Conduct Ribbon Quality Test as per Standard (Quality Test)",
                department: "Other",
                name: "Drive",
                email: "Udi@emerald-nw.com",
                notes: "—", 
                status: "completed",
                dueDate: "2024-05-12",
                qualityTestResultLinkHtml: "<a href='quality_test_results.html' target='_blank' class='details-button' style='display:inline-block; margin-bottom:5px; background-color: var(--accent-green); color:white;'>Test Results / ผลการทดสอบคุณภาพ</a>",
                qualityTestProcedureLinkHtml: "<a href='test_procedure.html' target='_blank' class='details-button' style='display:inline-block; background-color: var(--accent-blue); color:white;'>Test Procedure / ขั้นตอนมาตรฐานการทดสอบ</a>"
            },
            {
                task: "2. Process Request for Approved Material Evaluation Control (ENI-R&D-07)",
                department: "Other",
                name: "Drive",
                email: "Udi@emerald-nw.com",
                notes: "Attach documents Ref. ENI-R&D-07 No. 009/25, 010/25, 011/25\n012/25, 013/25",
                status: "in-progress",
                dueDate: "2025-05-13"
            },
            {
                task: "3. Supplier Product Presentation and Company Profile (16/05/2025 11:00–12:00)",
                department: "Other",
                name: "Drive",
                email: "Udi@emerald-nw.com",
                notes: "Attendee List:\n\nK’ Sophia\nPosition: MD\nEmail: swong@emerald-nw.com\n\nP’ Shell\nPosition: Management\nEmail: parinya_s@emerald-nw.com\n\nP' Koy\nPosition: Production Manager\nEmail: pakornpong-kam@emerald-nw.com\n\nP’ Tammy\nPosition: Purchasing Manager\nEmail: tammy@emerald-nw.com\n\nP’ Jo\nPosition: R&D\nEmail: rd@emerald-nw.com",
                status: "in-progress",
                dueDate: "2025-05-16"
            }
        ];
        
        function applyStatusColor(selectElement) {
            selectElement.classList.remove('status-completed', 'status-in-progress'); // Remove old status classes
            if (selectElement.value === 'completed') {
                selectElement.classList.add('status-completed');
            } else if (selectElement.value === 'in-progress') {
                selectElement.classList.add('status-in-progress');
            }
        }

        function createRowHtml(taskData, isConfirmed = false) {
            const row = todoTableBody.insertRow();
            if (isConfirmed) row.classList.add('confirmed');

            const taskDetailCell = row.insertCell();
            taskDetailCell.style.verticalAlign = 'top';

            const taskCellContentDiv = document.createElement('div');
            taskCellContentDiv.className = 'task-cell-content';

            const taskInput = document.createElement('input');
            taskInput.type = 'text';
            taskInput.className = 'task-input';
            taskInput.value = taskData.task || '';
            taskInput.placeholder = 'Task Description';
            taskInput.disabled = isConfirmed;
            taskCellContentDiv.appendChild(taskInput);

            if (taskData.qualityTestResultLinkHtml) {
                const qualityTestResultDiv = document.createElement('div');
                qualityTestResultDiv.style.marginTop = '8px';
                qualityTestResultDiv.innerHTML = taskData.qualityTestResultLinkHtml;
                taskCellContentDiv.appendChild(qualityTestResultDiv);
            }
            if (taskData.qualityTestProcedureLinkHtml) {
                const qualityTestProcedureDiv = document.createElement('div');
                qualityTestProcedureDiv.style.marginTop = '5px';
                qualityTestProcedureDiv.innerHTML = taskData.qualityTestProcedureLinkHtml;
                taskCellContentDiv.appendChild(qualityTestProcedureDiv);
            }
            
            const subDetailsDiv = document.createElement('div');
            subDetailsDiv.className = 'sub-details';
            subDetailsDiv.innerHTML = `
                <div class="responsible-block">
                    <label>Responsible</label>
                    <select class="dept-select" ${isConfirmed ? 'disabled' : ''}>
                        ${departments.map(dept => `<option value="${dept}" ${taskData.department === dept ? 'selected' : ''}>${dept}</option>`).join('')}
                    </select>
                    <input type="text" class="resp-name-input" value="${taskData.name || ''}" placeholder="Name" ${isConfirmed ? 'disabled' : ''}>
                    <input type="email" class="resp-email-input" value="${taskData.email || ''}" placeholder="Email" ${isConfirmed ? 'disabled' : ''}>
                </div>
                <div class="notes-block">
                    <label>Notes / Files</label>
                    <textarea class="notes-input" placeholder="Add notes or file links..." ${isConfirmed ? 'disabled' : ''}>${taskData.notes || ''}</textarea>
                </div>
            `;
            taskCellContentDiv.appendChild(subDetailsDiv);
            taskDetailCell.appendChild(taskCellContentDiv);

            const statusCell = row.insertCell();
            const statusSelect = document.createElement('select');
            statusSelect.className = 'status-select';
            statusSelect.disabled = isConfirmed;
             Object.entries(statusOptions).forEach(([value, text]) => {
                const option = document.createElement('option');
                option.value = value; option.textContent = text;
                if (taskData.status === value) option.selected = true;
                statusSelect.appendChild(option);
            });
            applyStatusColor(statusSelect); // Apply initial color
            statusSelect.addEventListener('change', function() { applyStatusColor(this); }); // Add listener for changes
            statusCell.appendChild(statusSelect);


            const dateCell = row.insertCell();
            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.value = taskData.dueDate || '';
            dateInput.disabled = isConfirmed;
            dateCell.appendChild(dateInput);

            const actionCell = row.insertCell();
            if (!isConfirmed) {
                 actionCell.innerHTML = `
                    <button class="action-btn move-up-btn" onclick="moveRow(this, -1)" title="Move Up">⬆️</button>
                    <button class="action-btn move-down-btn" onclick="moveRow(this, 1)" title="Move Down">⬇️</button>
                    <button class="action-btn delete-row-btn" onclick="deleteRow(this)" title="Delete Task">🗑️</button>
                `;
            } else { 
                actionCell.innerHTML = '';
            }
            return row;
        }

        function getTableData(includeConfirmedStatus = false) {
            const data = [];
            const rows = todoTableBody.rows;
            for (let i = 0; i < rows.length; i++) {
                const taskCell = rows[i].cells[0];
                const statusCell = rows[i].cells[1];
                const dateCell = rows[i].cells[2];
                
                let originalTask = currentTasks.find(t => t.task === taskCell.querySelector('.task-input').value) || {};
                if (localStorage.getItem(LOCAL_STORAGE_KEY)) {
                    try { // Add try-catch for parsing local storage
                        const savedTasks = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEY));
                        if (Array.isArray(savedTasks)) {
                           originalTask = savedTasks.find(t => t.task === taskCell.querySelector('.task-input').value) || originalTask;
                        }
                    } catch (e) {
                        console.error("Error parsing saved tasks in getTableData:", e);
                    }
                }

                const rowData = {
                    task: taskCell.querySelector('.task-input').value,
                    department: taskCell.querySelector('.dept-select').value,
                    name: taskCell.querySelector('.resp-name-input').value,
                    email: taskCell.querySelector('.resp-email-input').value,
                    notes: taskCell.querySelector('.notes-input').value,
                    status: statusCell.querySelector('.status-select').value,
                    dueDate: dateCell.querySelector('input[type="date"]').value,
                    qualityTestResultLinkHtml: originalTask.qualityTestResultLinkHtml,
                    qualityTestProcedureLinkHtml: originalTask.qualityTestProcedureLinkHtml
                };
                 if (includeConfirmedStatus) {
                     rowData.confirmed = rows[i].classList.contains('confirmed');
                 }
                data.push(rowData);
            }
            return data;
        }
        
        function populateTableWithTasks(tasksToLoad, isPlanConfirmedOverall) {
            todoTableBody.innerHTML = ''; 
            tasksToLoad.forEach(task => {
                const fullTaskData = {
                    task: task.task || "",
                    department: task.department || departments[0],
                    name: task.name || "",
                    email: task.email || "",
                    notes: task.notes || "",
                    status: task.status || "not-started",
                    dueDate: task.dueDate || "",
                    confirmed: task.confirmed || false,
                    qualityTestResultLinkHtml: task.qualityTestResultLinkHtml, 
                    qualityTestProcedureLinkHtml: task.qualityTestProcedureLinkHtml
                };
                createRowHtml(fullTaskData, isPlanConfirmedOverall || fullTaskData.confirmed);
            });
        }

        function loadData() {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            let activeTasks = JSON.parse(JSON.stringify(currentTasks)); 

            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    if (Array.isArray(parsedData) && parsedData.length > 0) {
                        activeTasks = parsedData.map(task => ({
                            ...task, 
                            department: task.department || departments[0],
                            name: task.name || "",
                            email: task.email || "",
                            notes: task.notes || "",
                            status: task.status || "not-started",
                            dueDate: task.dueDate || "",
                            confirmed: task.confirmed || false,
                            qualityTestResultLinkHtml: task.qualityTestResultLinkHtml,
                            qualityTestProcedureLinkHtml: task.qualityTestProcedureLinkHtml
                        }));
                    } else if (Array.isArray(parsedData) && parsedData.length === 0) {
                         activeTasks = []; 
                    }
                } catch (e) {
                    console.error("Error parsing saved data:", e);
                    activeTasks = JSON.parse(JSON.stringify(currentTasks));
                }
            }
            
            const isPlanConfirmedOverall = localStorage.getItem(LOCAL_STORAGE_KEY + '_confirmed') === 'true';
            populateTableWithTasks(activeTasks, isPlanConfirmedOverall);
            updateButtonStates(isPlanConfirmedOverall); 
            document.querySelectorAll('.notes-input').forEach(textarea => {
                textarea.style.height = 'auto';
                textarea.style.height = (textarea.scrollHeight) + 'px';
            });
        }

         function saveData() {
             try {
                 const dataToSave = getTableData(true);
                 localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(dataToSave));
                 alert('Action plan saved.');
             } catch (e) { console.error("Error saving:", e); alert('Error saving data.'); }
         }

        function addTaskRow() {
             const isConfirmed = localStorage.getItem(LOCAL_STORAGE_KEY + '_confirmed') === 'true';
             if (isConfirmed) { alert("Plan is confirmed and locked. Cannot add new tasks."); return; }
             const newRowEl = createRowHtml({ task: "", department: departments[0], name: "", email: "", notes: "", status: "not-started", dueDate: "" });
             const newTextarea = newRowEl.querySelector('.notes-input');
              if (newTextarea) {
                newTextarea.addEventListener('input', autoGrowTextarea);
                autoGrowTextarea.call(newTextarea); 
            }
        }

        function deleteRow(button) {
            const row = button.closest('tr');
            if (row.classList.contains('confirmed')) {
                 alert("This task is part of a confirmed plan and cannot be deleted individually.");
                 return;
            }
             if (confirm('Are you sure you want to delete this task?')) { row.remove(); }
        }

        function moveRow(button, direction) {
            const row = button.closest('tr');
             if (row.classList.contains('confirmed')) {
                alert("Cannot reorder tasks in a confirmed plan.");
                return;
            }
             const tbody = row.parentNode;
             const index = Array.from(tbody.children).indexOf(row);
             if (direction === -1 && index > 0) { tbody.insertBefore(row, tbody.children[index - 1]); }
             else if (direction === 1 && index < tbody.children.length - 1) { tbody.insertBefore(row, tbody.children[index + 2] || null); }
        }
        
        function updateButtonStates(isPlanConfirmed) {
            const addBtn = document.querySelector('.add-row-btn');
            const confirmBtn = document.querySelector('.confirm-btn');
            const cancelConfirmBtn = document.querySelector('.cancel-confirm-btn');
            
            if (addBtn) {
                addBtn.disabled = isPlanConfirmed;
                addBtn.style.opacity = isPlanConfirmed ? 0.6 : 1;
                addBtn.style.cursor = isPlanConfirmed ? 'not-allowed' : 'pointer';
            }
            if (confirmBtn) {
                confirmBtn.disabled = isPlanConfirmed;
                confirmBtn.style.opacity = isPlanConfirmed ? 0.6 : 1;
                confirmBtn.style.cursor = isPlanConfirmed ? 'not-allowed' : 'pointer';
            }
            if (cancelConfirmBtn) {
                cancelConfirmBtn.disabled = !isPlanConfirmed;
                cancelConfirmBtn.style.opacity = !isPlanConfirmed ? 0.6 : 1;
                cancelConfirmBtn.style.cursor = !isPlanConfirmed ? 'not-allowed' : 'pointer';
            }
        }

        function confirmData() {
             if (localStorage.getItem(LOCAL_STORAGE_KEY + '_confirmed') === 'true') {
                 alert("Plan is already confirmed.");
                 return;
             }
             if (confirm('Are you sure you want to confirm this action plan? This will lock the tasks for editing and reordering.')) {
                 const rows = todoTableBody.rows;
                 for (let i = 0; i < rows.length; i++) {
                     rows[i].classList.add('confirmed');
                     const inputs = rows[i].querySelectorAll('input, select, textarea');
                     inputs.forEach(input => {
                        input.disabled = true;
                        // If it's a status select, ensure the .confirmed .status-select CSS overrides other status colors
                        if (input.classList.contains('status-select')) {
                            // No need to remove other status classes, CSS specificity will handle it
                        }
                     });
                     
                     const customButtons = rows[i].querySelectorAll('.details-button');
                     customButtons.forEach(btn => {
                         btn.style.pointerEvents = 'none'; 
                         btn.style.opacity = '0.7';
                         btn.style.backgroundColor = '#adb5bd'; 
                         btn.style.borderColor = '#adb5bd';
                     });

                     const actionCell = rows[i].cells[rows[i].cells.length - 1]; 
                     actionCell.innerHTML = ''; 
                 }
                 localStorage.setItem(LOCAL_STORAGE_KEY + '_confirmed', 'true');
                 updateButtonStates(true);
                 alert('Action plan confirmed and locked.');
                 saveData(); 
             }
        }

        function cancelConfirmData() {
            if (localStorage.getItem(LOCAL_STORAGE_KEY + '_confirmed') !== 'true') {
                 alert("Plan is not currently confirmed.");
                 return;
            }
            if (confirm('Are you sure you want to cancel the plan confirmation? This will unlock tasks for editing.')) {
                const rows = todoTableBody.rows;
                for (let i = 0; i < rows.length; i++) {
                    rows[i].classList.remove('confirmed');
                    const inputs = rows[i].querySelectorAll('input, select, textarea');
                    inputs.forEach(input => {
                        input.disabled = false;
                        if (input.classList.contains('status-select')) {
                            applyStatusColor(input); // Re-apply dynamic color after enabling
                        }
                    });

                    const customButtons = rows[i].querySelectorAll('.details-button');
                    customButtons.forEach(btn => {
                         btn.style.pointerEvents = 'auto';
                         btn.style.opacity = '1';
                         if (btn.textContent.includes("Test Results")) {
                             btn.style.backgroundColor = 'var(--accent-green)';
                         } else if (btn.textContent.includes("Test Procedure")) {
                             btn.style.backgroundColor = 'var(--accent-blue)';
                         } else {
                             btn.style.backgroundColor = 'var(--heading-color)';
                         }
                     });

                    const actionCell = rows[i].cells[rows[i].cells.length - 1]; 
                    actionCell.innerHTML = `
                        <button class="action-btn move-up-btn" onclick="moveRow(this, -1)" title="Move Up">⬆️</button>
                        <button class="action-btn move-down-btn" onclick="moveRow(this, 1)" title="Move Down">⬇️</button>
                        <button class="action-btn delete-row-btn" onclick="deleteRow(this)" title="Delete Task">🗑️</button>
                    `;
                }
                localStorage.setItem(LOCAL_STORAGE_KEY + '_confirmed', 'false');
                updateButtonStates(false);
                alert('Plan confirmation has been cancelled. Tasks are now editable.');
                saveData(); 
            }
        }
        
        function autoGrowTextarea() {
            this.style.height = 'auto'; 
            this.style.height = (this.scrollHeight) + 'px';
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            document.querySelectorAll('.notes-input').forEach(textarea => {
                textarea.addEventListener('input', autoGrowTextarea);
                autoGrowTextarea.call(textarea); 
            });
        });


        function exportToExcel(event) {
            event.preventDefault();
            if (typeof XLSX === 'undefined') { alert('SheetJS library not loaded.'); return; }
            const data = getTableData(); 
            const dataForExport = data.map(row => {
                let taskDescription = row.task;
                if (row.qualityTestResultLinkHtml) { 
                    taskDescription += `\n(Ref: Test Results)`; 
                }
                if (row.qualityTestProcedureLinkHtml) {
                    taskDescription += `\n(Ref: Test Procedure)`;
                }
                return {
                    "Task Description": taskDescription,
                    "Responsible Dept": row.department,
                    "Responsible Name": row.name,
                    "Email": row.email,
                    "Notes / Files": row.notes,
                    "Status": statusOptions[row.status] || row.status,
                    "Target Due Date": row.dueDate
                };
            });

            try {
                const ws = XLSX.utils.json_to_sheet(dataForExport);
                
                const colWidths = [];
                if (dataForExport.length > 0) {
                    Object.keys(dataForExport[0]).forEach(key => {
                        let maxLen = key.length; 
                        dataForExport.forEach(item => {
                            const cellValue = item[key] ? String(item[key]) : '';
                            const lines = cellValue.split('\n');
                            lines.forEach(line => {
                                if (line.length > maxLen) {
                                    maxLen = line.length;
                                }
                            });
                        });
                        let width;
                        if (key === "Task Description") width = Math.min(maxLen + 5, 70);
                        else if (key === "Notes / Files") width = Math.min(maxLen + 5, 60);
                        else width = Math.min(maxLen + 2, 35);
                        colWidths.push({ wch: width });
                    });
                }
                 ws['!cols'] = colWidths;

                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Ribbon Action Plan");

                if(ws['!ref']) { 
                    const range = XLSX.utils.decode_range(ws['!ref']);
                    for (let R = range.s.r; R <= range.e.r; ++R) {
                        const taskDescCellAddress = XLSX.utils.encode_cell({r: R, c: 0}); 
                        const notesCellAddress = XLSX.utils.encode_cell({r: R, c: 4}); 
                        if(ws[taskDescCellAddress]) ws[taskDescCellAddress].s = { alignment: { wrapText: true, vertical: 'top' } };
                        if(ws[notesCellAddress]) ws[notesCellAddress].s = { alignment: { wrapText: true, vertical: 'top' } };
                    }
                }

                XLSX.writeFile(wb, "Ribbon_Action_Plan.xlsx");
            } catch (e) { console.error("Error exporting:", e); alert("Error exporting to Excel."); }
        }
        
    </script>

</body>
</html>